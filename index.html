<!-- Import the component -->
<script type="module" src="model-viewer.js"></script>
<style>
    model-viewer{
        width: 100%;
        height : 500px;
    }
</style>
<!-- Use it like any other HTML element -->
        <video id="video-texture" style="display:none;" autoplay muted loop playsinline 
               src="./Dior-Jadore5th_916_LQ.mp4"
               onerror="this.onerror=null;this.src='https://placehold.co/1280x720/000000/FFFFFF?text=Video+Error';">
        </video>
<model-viewer id="viewer" src="./ModelMupiSolidBase.glb" ar alt="A 3D model of a duck" camera-controls background-color="#455A64">             
</model-viewer>
<script type="module">
        // Attend que la page soit entièrement chargée
        window.addEventListener('load', () => {
            
            const modelViewer = document.querySelector('#viewer');
            const video = document.querySelector('#video-texture');

            // --- BLOC DE DÉBOGAGE AMÉLIORÉ ---
            if (!video) {
                console.error("ERREUR CRITIQUE : L'élément vidéo avec l'ID '#video-texture' n'a pas été trouvé.");
                return; // Arrête l'exécution si la vidéo n'existe pas.
            }
            console.log("Élément vidéo trouvé:", video);
            console.log("Source initiale de la vidéo (attribut src):", video.getAttribute('src'));
            console.log("Source résolue de la vidéo (propriété src):", video.src);

            // Vérifie si la source de la vidéo est valide avant de continuer.
            if (!video.src || video.src.includes('[object HTMLVideoElement]')) {
                 console.error("ERREUR : La source de la vidéo est invalide. Vérifiez l'attribut 'src' dans votre HTML et assurez-vous qu'aucun script ne le modifie de manière incorrecte.", video.src);
                 return;
            }
            // --- FIN DU BLOC DE DÉBOGAGE ---

            let isModelLoaded = false;
            let isVideoReady = false;

            // Fonction qui sera appelée uniquement quand le modèle ET la vidéo seront prêts.
            const applyVideoTexture = async () => {
                // Si l'un des deux n'est pas prêt, on ne fait rien.
                if (!isModelLoaded || !isVideoReady) {
                    return;
                }

                console.log("Modèle et vidéo prêts. Tentative d'application de la texture.");
                try {
                    const texture = await modelViewer.createTexture(video);
                    
                    // IMPORTANT : Remplacez 'Screen' par le nom de matériel de VOTRE modèle.
                    const material = modelViewer.model.materials.find(m => m.name === 'Screen');
                    
                    if (material) {
                        console.log("Matériel trouvé:", material.name);
                        
                        material.pbrMetallicRoughness.setBaseColorFactor([1, 1, 1, 1]);
                        material.pbrMetallicRoughness.setBaseColorTexture(texture);
                        material.setEmissiveFactor([1, 1, 1]);
                        material.setEmissiveTexture(texture);
                        
                        console.log("Texture vidéo appliquée de force sur la couleur de base et l'émission.");

                    } else {
                        console.warn("Le matériel cible n'a pas été trouvé. La vidéo ne sera pas affichée.");
                        console.log("Matériaux disponibles :", modelViewer.model.materials.map(m => m.name));
                    }
                } catch (error) {
                    console.error("Erreur lors de la création ou de l'application de la texture vidéo :", error);
                }
            };

            // 1. On écoute l'événement 'load' du modèle 3D.
            modelViewer.addEventListener('load', () => {
                console.log('Modèle 3D chargé.');
                isModelLoaded = true;
                applyVideoTexture(); // On essaie d'appliquer la texture.
            });

            // 2. On écoute l'événement 'loadeddata' de la vidéo.
            video.addEventListener('loadeddata', () => {
                console.log('Données de la vidéo chargées et prêtes.');
                isVideoReady = true;
                video.play().catch(e => console.error("La lecture automatique de la vidéo a été bloquée :", e));
                applyVideoTexture(); // On essaie d'appliquer la texture.
            });
            
            // On s'assure que le navigateur tente de charger la vidéo.
            try {
                console.log("Appel de video.load() pour charger:", video.src);
                video.load();
            } catch (e) {
                console.error("Erreur lors de l'appel à video.load() :", e);
            }
        });
    </script>
                <button slot="ar-button" style="background-color: white; border-radius: 4px; border: solid blue; position: absolute; top: 16px; right: 16px; ">Activate AR</button>